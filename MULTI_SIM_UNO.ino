
int crankPin = 11;
int camPin = 12;
int val;
int analogValue;
int analogValueNormFiltered;
int analogPin = A0;
int trigger_IDX = 6;

// define DEBUG to see serial when running
#define DEBUG_no

//0 - C18E
//1 - L98
//2 - M15A
//3 - Z18XE
//4 - WRXOLD
//5 - KTM_SCE
//6 - VW EA888
//7 - 2NR-FE
//8 - EDIS
//9 - 36M1 FIESTA
//10 - TOYOTA 24-1
//11 - ROVER

const byte array_depth[] PROGMEM =
{
  240,
  240,
  144,
  240,
  120,
  144,
  240,
  144,
  8,
  144,
  96,
  144
};

const bool trigger_pols[] PROGMEM =
{
  1,
  1,
  1,
  1,
  0,
  1,
  0,
  0,
  0,
  0,
  0,
  1
};

const bool sync_pols[] PROGMEM =
{
  1,
  1,
  1,
  1,
  1,
  1,
  0,
  0,
  0,
  0,
  0,
  0
};

const byte sync[12][240] PROGMEM = 
{
  {//C18E Sync Data
    0,    
    0,    
    0,    
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0
  },
  {//L98 Sync Data
    0,    
    0,    
    0,    
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0
  },
  {//M15A Sync Data
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0   
  },
  {//Z18XE Sync Data
    0,    
    0,    
    0,    
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0
  },
  {//WRXOLD Sync Data
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0
  },
  {//KTM Sync Data
    0
  },
  {//VW EA888 Sync Data
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1
  },
  {//2NR-FE Sync Data
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1   
  },
  {//EDIS Sync Data
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1  
  },
  {//36M1 FIESTA Sync Data
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1   
  },
   {//24M1 TOYOTA Sync Data
    0},
    {//ROVER Sync Data
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,                                        
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,                 
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,                                        
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1, 
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0, 
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0}
};


const byte trigger[12][240] PROGMEM =
{
  {//C18E Trigger Data
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,                        
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,      
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,                        
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,      
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,                        
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,      
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,                        
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,      
    0,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    1
  },
  {//L98 Trigger Data
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,      
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0       
 },
 {//M15A Trigger Data
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,  
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1  
  },
  {//Z18XE Trigger Data
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,      
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0          
  },
  {//WRXOLD Trigger Data
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    1,
    0,
    0,
    0,
    0,
    1
  },
  {//KTM Trigger Data
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,          
  },
  {//VW EA888 Trigger Data
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,      
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,    
    1,
    1,
    0,
    0,
    0,
    0,
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,    
    1,
    0,
    1,
    0,    
    1,
    0,
    1,
    0
 },
{//2NR-FE Trigger Data
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,  
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0  
  },
  {//EDIS Trigger Data
    1,
    1,
    1,
    1,
    0,
    0,
    0,
    0  
  },
{//36M1 FIESTA Trigger Data
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,  
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0  
  },
{//24M1 TOYOTA Trigger Data
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    1,
    1,
    1,
    1,
    1,
    1,
    0},
{//ROVER Trigger Data
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    1,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0,
    1,
    0}
};

const int time_delays[] PROGMEM =
{ \
10000,  \
5000, \
2500, \
1666, \
1250, \
1000, \
833, \
714, \
625, \
555, \
500, \
454, \
416, \
384, \
357, \
333, \
312, \
294, \
277, \
263, \
250, \
238, \
227, \
217, \
208, \
200, \
192, \
185, \
178, \
172, \
166, \
161, \
156, \
151, \
147, \
142, \
138, \
135, \
131, \
128, \
125, \
121, \
119, \
116, \
113, \
111, \
108, \
106, \
104, \
102, \
100, \
98, \
96, \
94, \
92, \
90, \
89, \
87, \
86, \
84, \
83, \
81, \
80, \
79, \
78, \
76, \
75, \
74, \
73, \
72, \
71, \
70, \
69, \
68, \
67, \
66, \
65, \
64, \
64, \
63, \
62, \
61, \
60, \
60, \
59, \
58, \
58, \
57, \
56, \
56, \
55, \
54, \
54, \
53, \
53, \
52, \
52, \
51, \
51, \
50, \
50, \
49, \
49, \
48, \
48, \
47, \
47, \
46, \
46, \
45, \
45, \
45, \
44, \
44, \
43, \
43, \
43, \
42, \
42, \
42, \
41, \
41, \
40, \
40, \
40, \
40, \
39, \
39, \
39, \
38, \
38, \
38, \
37, \
37, \
37, \
37, \
36, \
36, \
36, \
35, \
35, \
35, \
35, \
34, \
34, \
34, \
34, \
34, \
33, \
33, \
33, \
33, \
32, \
32, \
32, \
32, \
32, \
31, \
31, \
31, \
31, \
31, \
30, \
30, \
30, \
30, \
30, \
29, \
29, \
29, \
29, \
29, \
29, \
28, \
28, \
28, \
28, \
28, \
28, \
27, \
27, \
27, \
27, \
27, \
27, \
27, \
26, \
26, \
26, \
26, \
26, \
26, \
26, \
25, \
25, \
25, \
25, \
25, \
25, \
25, \
25, \
24, \
24, \
24, \
24, \
24, \
24, \
24, \
24, \
23, \
23, \
23, \
23, \
23, \
23, \
23, \
23, \
23, \
22, \
22, \
22, \
22, \
22, \
22, \
22, \
22, \
22, \
22, \
21, \
21, \
21, \
21, \
21, \
21, \
21, \
21, \
21, \
21, \
21, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
20, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
19, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
18, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
17, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
16, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
15, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
14, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
13, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
12, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
11, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
10, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
9, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
8, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
7, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
6, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
5, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4, \
4};


void setup()
{
 
}

void loop()
{
   int loopCount;
   int delayCount;
   int toothCount;
   int sampleSum = 0;
   int triggerTypes = 12;
   int analogHyst = 100;
   int temp;
   char printBuff[128];
   byte polarityCrank;
   byte stateCrank;
   byte polaritySync;
   byte stateSync;
   int arrayDepth;
   int crankOffsetBase;
   int syncOffsetBase;

   Serial.begin(112500);   // Initialize Native USB port
   while(!Serial);        // Wait until connection is established

   pinMode(crankPin, OUTPUT);      // sets the digital pin as output
   pinMode(camPin, OUTPUT);      // sets the digital pin as output  
   
   for (loopCount = 0; loopCount < 10; loopCount++)
   {
      sampleSum += analogRead(analogPin);
   }

   // 900UL - UNO AD seems to max at 900 so 10 samples x 900 = 9000
   trigger_IDX = sampleSum / (9000UL / triggerTypes);
   trigger_IDX = triggerTypes <= trigger_IDX ? triggerTypes - 1 : trigger_IDX;

   Serial.print("\r\n\r\nTrigger index: ");
   Serial.print(trigger_IDX);

   switch (trigger_IDX)
   {
    case 0: Serial.print(" - C18E"); break;
    case 1: Serial.print(" - L98"); break;
    case 2: Serial.print(" - M15A"); break;
    case 3: Serial.print(" - Z18XE"); break;
    case 4: Serial.print(" - WRXOLD"); break;
    case 5: Serial.print(" - KTM_SCE"); break;
    case 6: Serial.print(" - VW EA888"); break;
    case 7: Serial.print(" - 2NR-FE"); break;
    case 8: Serial.print(" - EDIS"); break;
    case 9: Serial.print(" - 36M1 FIESTA"); break;
    case 10: Serial.print(" - TOYOTA 24-1"); break;
    case 11: Serial.print(" - ROVER"); break;
    default: Serial.print(" - UNKNOWN"); break;
   }

   // give user some time to move trim-pot back to cranking or off position
   Serial.print("\r\nNow move trim-pot to starting RPM value\r\n");  

   for (loopCount = 0; loopCount < 40; loopCount++)
   {
      Serial.print('.');  
      delay(100);
   }
   
   arrayDepth = pgm_read_byte_near(array_depth + trigger_IDX);

   crankOffsetBase = trigger_IDX * (int)240;
   syncOffsetBase = trigger_IDX * (int)240;

   while (true)
   {    
     for (toothCount = 0; toothCount < arrayDepth; toothCount++)
     {
        analogValue = analogRead(analogPin); 
        analogValueNormFiltered = (3 * analogValueNormFiltered + analogValue) >> 2;
#ifdef DEBUG
        Serial.print(crankOffsetBase); 
        Serial.print("\r\n"); 
        Serial.print(syncOffsetBase); 
        Serial.print("\r\n"); 
        
        Serial.print("\r\n"); 
        Serial.print(analogValueNormFiltered); 
#endif // DEBUG
        temp = pgm_read_word_near(time_delays + analogValueNormFiltered);
#ifdef DEBUG
        Serial.print("\r\n"); 
        Serial.print(temp); 
        Serial.print("\r\n"); 
        Serial.print("\r\n"); 
#endif // DEBUG

        polarityCrank = pgm_read_byte_near(trigger_pols + trigger_IDX);
        stateCrank = pgm_read_byte_near(&trigger[0][0] + crankOffsetBase + toothCount);

        polaritySync = pgm_read_byte_near(sync_pols + trigger_IDX);
        stateSync = pgm_read_byte_near(&sync[0][0] + syncOffsetBase + toothCount);
  
        for (delayCount = 0; delayCount < temp; delayCount++)
        {          
          if (polarityCrank == stateCrank)
          {
             digitalWrite(crankPin, HIGH); 
#ifdef DEBUG             
             Serial.print("CH"); 
#endif // DEBUG             
          }
          else
          {
             digitalWrite(crankPin, LOW); 
#ifdef DEBUG             
             Serial.print("CL"); 
#endif // DEBUG             
          }    

          if (polaritySync == stateSync)
          {
             digitalWrite(camPin, HIGH); 
#ifdef DEBUG             
             Serial.print("SH");
#endif // DEBUG             
          }
          else
          {
             digitalWrite(camPin, LOW); 
#ifdef DEBUG             
             Serial.print("SL");
#endif // DEBUG             
          }  
        }
      }                  
   }
}
